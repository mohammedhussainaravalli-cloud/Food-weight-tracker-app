<!DOCTYPE html>
<html>
<head>
    <base target="_top">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>MH's Weight Loss App</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="MH's Weight Loss App">
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            width: 100%;
            height: 100%;
            overflow-x: hidden;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
            margin: 0;
            padding: 0;
            width: 100vw;
            overflow-x: hidden;
        }

        .header {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            padding: 12px 16px;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .hamburger-menu {
            background: none;
            border: none;
            cursor: pointer;
            padding: 10px;
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            width: 30px;
            height: 30px;
        }

        .hamburger-line {
            width: 25px;
            height: 3px;
            background-color: white;
            border-radius: 2px;
            transition: 0.3s;
        }

        .calories-display {
            background: rgba(255, 255, 255, 0.25);
            padding: 6px 12px;
            border-radius: 16px;
            font-weight: bold;
            font-size: 14px;
        }

        .sidebar {
            position: fixed;
            top: 0;
            left: -80vw;
            width: 80vw;
            max-width: 280px;
            height: 100vh;
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            transition: left 0.3s ease;
            z-index: 1001;
            padding-top: 60px;
            box-sizing: border-box;
        }

        .sidebar.open {
            left: 0;
        }

        .sidebar-item {
            padding: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: background 0.3s ease;
            color: white;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .sidebar-item:hover, .sidebar-item.active {
            background: rgba(118, 75, 162, 0.5);
        }

        .main-content {
            margin-top: 55px;
            padding: 0;
            width: 100vw;
            max-width: 100vw;
            margin-left: 0;
            margin-right: 0;
            box-sizing: border-box;
        }

        .greeting {
            text-align: center;
            margin-bottom: 20px;
            padding: 0 16px;
        }

        .greeting h1 {
            font-size: 24px;
            font-style: italic;
            margin-bottom: 8px;
            background: linear-gradient(45deg, #fff, #f0f0f0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .greeting h2 {
            font-size: 16px;
            opacity: 0.8;
            margin-bottom: 15px;
        }

        .quote-section, .current-weight-display, .meal-form, .todays-meals-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 0;
            padding: 16px;
            margin: 0 0 2px 0;
            border: none;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .current-weight-display {
            text-align: center;
            margin-bottom: 20px;
        }

        .current-weight-display h3 {
            margin-bottom: 8px;
            font-size: 14px;
            opacity: 0.8;
        }

        .current-weight-value {
            font-size: 24px;
            font-weight: bold;
            color: #fff;
        }

        .quote-header {
            font-size: 16px;
            font-weight: bold;
            color: white;
            margin-bottom: 15px;
            text-align: left;
        }

        .quote-text {
            font-style: italic;
            text-align: center;
            color: white;
            font-size: 16px;
            line-height: 1.4;
        }

        .section-header {
            font-size: 16px;
            font-weight: bold;
            color: white;
            margin-bottom: 15px;
        }

        .meals-list {
            color: white;
        }

        .meal-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 4px solid rgba(255, 255, 255, 0.3);
        }

        .meal-details {
            flex: 1;
        }

        .meal-time {
            font-weight: bold;
            font-size: 14px;
            opacity: 0.8;
        }

        .meal-type {
            font-weight: bold;
            margin-bottom: 4px;
        }

        .meal-description {
            font-size: 14px;
            opacity: 0.9;
        }

        .meal-calories {
            background: rgba(102, 126, 234, 0.3);
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            min-width: 60px;
            text-align: center;
        }

        .no-meals {
            text-align: center;
            opacity: 0.7;
            font-style: italic;
            padding: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: bold;
            color: white;
            font-size: 14px;
        }

        .form-group select, .form-group input[type="text"], .form-group input[type="number"] {
            width: 100%;
            padding: 14px 16px;
            border: none;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 16px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }

        .form-group select option {
            background: #764ba2;
            color: white;
        }

        .form-group input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.5);
            background: rgba(255, 255, 255, 0.3);
        }

        .emoji-rating {
            display: flex;
            justify-content: space-around;
            margin-top: 10px;
        }

        .emoji-rating span {
            font-size: 28px;
            cursor: pointer;
            opacity: 0.5;
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        .emoji-rating span.selected {
            opacity: 1;
            transform: scale(1.2);
        }

        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: none;
            padding: 16px 24px;
            border-radius: 12px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            font-size: 16px;
            transition: transform 0.2s ease;
            position: relative;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            transform: none;
            cursor: not-allowed;
        }

        .loading {
            display: none;
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }

        .weight-section {
            display: none;
        }

        .weight-section.active {
            display: block;
        }

        .chart-container {
            position: relative;
            width: 100vw;
            height: 250px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 15px;
            margin: 0;
            border-radius: 0;
            box-sizing: border-box;
        }

        #weightChart {
            width: 100% !important;
            height: 100% !important;
            max-width: 100%;
        }

        .weight-input-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: none;
            padding: 16px 24px;
            border-radius: 0;
            color: white;
            font-weight: bold;
            cursor: pointer;
            width: 100vw;
            font-size: 16px;
            margin: 0;
            box-sizing: border-box;
        }

        .weight-history {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 0;
            padding: 16px;
            max-height: 300px;
            overflow-y: auto;
            width: 100vw;
            margin: 0;
            box-sizing: border-box;
        }

        .weight-entry {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1002;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 15% auto;
            padding: 30px;
            border-radius: 15px;
            width: 80%;
            max-width: 400px;
            text-align: center;
        }

        .close {
            color: white;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            margin-top: -20px;
        }

        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }

        .overlay.open {
            display: block;
        }

        .error-message {
            background: rgba(255, 0, 0, 0.2);
            border: 1px solid rgba(255, 0, 0, 0.5);
            color: white;
            padding: 10px;
            border-radius: 10px;
            margin: 10px 0;
            display: none;
        }

        .success-message {
            background: rgba(0, 255, 0, 0.2);
            border: 1px solid rgba(0, 255, 0, 0.5);
            color: white;
            padding: 10px;
            border-radius: 10px;
            margin: 10px 0;
            display: none;
        }

        .connection-status {
            position: fixed;
            top: 60px;
            right: 10px;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            z-index: 1001;
            display: none;
        }

        .connection-status.online {
            background: rgba(0, 255, 0, 0.2);
            border: 1px solid rgba(0, 255, 0, 0.5);
            color: white;
        }

        .connection-status.offline {
            background: rgba(255, 0, 0, 0.2);
            border: 1px solid rgba(255, 0, 0, 0.5);
            color: white;
        }

        /* Comprehensive Mobile Responsive Design */
        @media screen and (max-width: 768px) {
            body {
                overflow-x: hidden;
            }
            
            .main-content {
                padding: 0;
                margin-top: 50px;
                width: 100vw;
            }
            
            .greeting {
                padding: 12px 16px;
            }
            
            .greeting h1 {
                font-size: 20px;
            }
            
            .greeting h2 {
                font-size: 14px;
            }
            
            .quote-section, .current-weight-display, .meal-form, .todays-meals-section {
                padding: 16px;
                margin: 0;
                width: 100vw;
            }
            
            .header {
                padding: 8px 12px;
            }
            
            .calories-display {
                font-size: 12px;
                padding: 4px 8px;
                max-width: 50%;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
            }
        }

        @media screen and (max-width: 480px) {
            .main-content {
                padding: 0;
                margin-top: 45px;
                width: 100vw;
            }

            .quote-section, .current-weight-display, .meal-form, .todays-meals-section {
                padding: 12px;
                margin: 0;
                width: 100vw;
            }

            .form-group {
                margin-bottom: 10px;
            }
            
            .form-group input, .form-group select {
                padding: 12px;
                font-size: 16px;
            }

            .btn-primary {
                min-height: 48px;
                font-size: 16px;
                border-radius: 0;
                margin: 16px 0 0 0;
                width: 100vw;
            }

            .modal-content {
                width: 100vw;
                height: 100vh;
                margin: 0;
                border-radius: 0;
                padding: 20px;
            }

            .chart-container {
                padding: 12px;
                height: 220px;
                width: 100vw;
            }
            
            .sidebar {
                width: 85vw;
                left: -85vw;
            }
        }

        @media screen and (max-width: 375px) {
            .header {
                padding: 6px 10px;
            }
            
            .calories-display {
                font-size: 10px;
                padding: 3px 6px;
                max-width: 45%;
            }
            
            .hamburger-menu {
                width: 30px;
                height: 30px;
                padding: 8px;
            }
            
            .hamburger-line {
                width: 18px;
                height: 2px;
            }
            
            .chart-container {
                height: 200px;
                padding: 10px;
            }
        }

        @media screen and (max-width: 320px) {
            .main-content {
                margin-top: 40px;
            }
            
            .header {
                padding: 4px 8px;
            }
            
            .calories-display {
                font-size: 9px;
                padding: 2px 4px;
                max-width: 40%;
            }
            
            .greeting h1 {
                font-size: 18px;
            }
            
            .greeting h2 {
                font-size: 12px;
            }
            
            .chart-container {
                height: 180px;
                padding: 8px;
            }
            
            .sidebar {
                width: 90vw;
                left: -90vw;
            }
        }

        /* Touch device optimizations */
        @media (hover: none) and (pointer: coarse) {
            .hamburger-menu {
                padding: 12px;
                width: 44px;
                height: 44px;
            }

            .sidebar-item {
                padding: 16px 20px;
                min-height: 56px;
            }

            .emoji-rating span {
                font-size: 28px;
                padding: 12px;
                min-width: 44px;
                min-height: 44px;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .meal-item {
                padding: 16px;
                margin-bottom: 2px;
            }

            .weight-input-btn {
                min-height: 48px;
                padding: 16px 24px;
            }
        }
    </style>
</head>
<body>
    <div class="connection-status" id="connectionStatus">
        Connected
    </div>

    <div class="header">
        <button class="hamburger-menu" onclick="toggleSidebar()">
            <div class="hamburger-line"></div>
            <div class="hamburger-line"></div>
            <div class="hamburger-line"></div>
        </button>
        <div class="calories-display">
            Today: <span id="dailyCalories">Loading...</span> cal
        </div>
    </div>

    <div class="overlay" id="overlay" onclick="closeSidebar()"></div>

    <div class="sidebar" id="sidebar">
        <div class="sidebar-item active" onclick="showHome()">
            🏠 Home
        </div>
        <div class="sidebar-item" onclick="showWeightTracking()">
            📊 Weight Tracking
        </div>
    </div>

    <div class="main-content">
        <!-- Home Section -->
        <div id="homeSection">
            <div class="greeting">
                <h1>Hello, Mohammed!</h1>
                <h2>How have you been eating?</h2>
            </div>

            <!-- Current Weight Display -->
            <div class="current-weight-display">
                <h3>Current Weight</h3>
                <div class="current-weight-value" id="currentWeightValue">Loading...</div>
            </div>

            <div class="quote-section">
                <div class="quote-header">Quote of the day</div>
                <div class="quote-text" id="quoteOfTheDay">Loading inspirational quote...</div>
            </div>

            <div class="error-message" id="errorMessage"></div>
            <div class="success-message" id="successMessage"></div>

            <div class="meal-form">
                <h3 style="margin-bottom: 20px; text-align: center; color: white;">Log Your Meal</h3>
                
                <div class="form-group">
                    <label>Hour of the day:</label>
                    <select id="mealHour">
                        <option value="">Select hour</option>
                        <option value="0">0:00</option>
                        <option value="1">1:00</option>
                        <option value="2">2:00</option>
                        <option value="3">3:00</option>
                        <option value="4">4:00</option>
                        <option value="5">5:00</option>
                        <option value="6">6:00</option>
                        <option value="7">7:00</option>
                        <option value="8">8:00</option>
                        <option value="9">9:00</option>
                        <option value="10">10:00</option>
                        <option value="11">11:00</option>
                        <option value="12">12:00</option>
                        <option value="13">13:00</option>
                        <option value="14">14:00</option>
                        <option value="15">15:00</option>
                        <option value="16">16:00</option>
                        <option value="17">17:00</option>
                        <option value="18">18:00</option>
                        <option value="19">19:00</option>
                        <option value="20">20:00</option>
                        <option value="21">21:00</option>
                        <option value="22">22:00</option>
                        <option value="23">23:00</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Type of meal:</label>
                    <select id="mealType">
                        <option value="">Select meal type</option>
                        <option value="Breakfast">Breakfast</option>
                        <option value="Mid-day snack">Mid-day snack</option>
                        <option value="Lunch">Lunch</option>
                        <option value="Evening snack">Evening snack</option>
                        <option value="Dinner">Dinner</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>What did you eat?</label>
                    <input type="text" id="mealDescription" placeholder="Describe your meal (e.g., 2 chapatis with dal, rice with curry)">
                </div>

                <div class="form-group">
                    <label>Approximate Calories (optional):</label>
                    <input type="number" id="calories" placeholder="Enter calories (optional)" min="0">
                </div>

                <div class="form-group">
                    <label>How did you feel?</label>
                    <div class="emoji-rating" id="feelingRating">
                        <span onclick="selectFeeling(1)">😞</span>
                        <span onclick="selectFeeling(2)">😕</span>
                        <span onclick="selectFeeling(3)">😐</span>
                        <span onclick="selectFeeling(4)">😊</span>
                        <span onclick="selectFeeling(5)">😍</span>
                    </div>
                </div>

                <button class="btn-primary" onclick="logMeal()" id="logMealBtn">
                    <span class="btn-text">Log Meal</span>
                    <div class="loading">⏳</div>
                </button>
            </div>

            <!-- Today's Meals Section -->
            <div class="todays-meals-section">
                <div class="section-header">What I've eaten today</div>
                <div id="todayMealsList" class="meals-list">
                    Loading today's meals...
                </div>
            </div>
        </div>

        <!-- Weight Tracking Section -->
        <div id="weightSection" class="weight-section">
            <div style="text-align: center; margin-bottom: 30px;">
                <h1>Weight Tracking</h1>
            </div>

            <div class="chart-container">
                <canvas id="weightChart"></canvas>
            </div>

            <button class="weight-input-btn" onclick="showWeightModal()">
                Add Today's Weight
            </button>

            <div class="weight-history">
                <h3 style="margin-bottom: 15px;">Weight History</h3>
                <div id="weightHistoryList">
                    Loading weight history...
                </div>
            </div>
        </div>
    </div>

    <!-- Weight Input Modal -->
    <div id="weightModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeWeightModal()">&times;</span>
            <h2 style="margin-bottom: 20px;">Add Your Weight</h2>
            <div class="error-message" id="weightErrorMessage"></div>
            <div class="form-group">
                <input type="number" id="weightInput" placeholder="Enter weight in KG" step="0.1" min="0">
            </div>
            <button class="btn-primary" onclick="saveWeight()" id="saveWeightBtn">
                <span class="btn-text">Save</span>
                <div class="loading">⏳</div>
            </button>
        </div>
    </div>

    <script>
        // REPLACE THESE WITH YOUR SUPABASE CREDENTIALS
        const SUPABASE_URL = ' https://azttcadavuonflvqihjt.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF6dHRjYWRhdnVvbmZsdnFpaGp0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg5NTUwMDUsImV4cCI6MjA3NDUzMTAwNX0.4WQDtvkF3xmrNlQ33W495EYKGmz7k1SqmUopUgfHJbc';
        
        // Global variables
        let selectedFeeling = null;
        let weightChart = null;

        // Inspirational quotes
        const quotes = [
            "The groundwork for all happiness is good health.",
            "Take care of your body. It's the only place you have to live.",
            "Health is not about the weight you lose, but about the life you gain.",
            "Your body can do it. It's your mind you need to convince.",
            "Progress, not perfection.",
            "Small changes lead to big results.",
            "Believe in yourself and all that you are.",
            "Every meal is a fresh start.",
            "You are stronger than your excuses.",
            "Healthy eating is a form of self-respect."
        ];

        // Supabase API helper functions
        async function supabaseRequest(endpoint, options = {}) {
            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1${endpoint}`, {
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                        'Content-Type': 'application/json',
                        'Prefer': 'return=representation',
                        ...options.headers
                    },
                    ...options
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                return await response.json();
            } catch (error) {
                console.error('Supabase request failed:', error);
                showConnectionStatus(false);
                throw error;
            }
        }

        // Connection status
        function showConnectionStatus(isOnline) {
            const status = document.getElementById('connectionStatus');
            if (isOnline) {
                status.className = 'connection-status online';
                status.textContent = 'Connected';
                status.style.display = 'block';
