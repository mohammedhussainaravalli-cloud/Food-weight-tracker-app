<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MH's Weight Loss App</title>
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="MH's Weight Loss App">
    <script src="https://apis.google.com/js/api.js"></script> <!-- Google API Client Library -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
        }

        .header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 10px 15px;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .hamburger-menu {
            background: none;
            border: none;
            cursor: pointer;
            padding: 8px;
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            width: 28px;
            height: 28px;
        }

        .hamburger-line {
            width: 22px;
            height: 2px;
            background-color: white;
            border-radius: 2px;
            transition: 0.3s;
        }

        .calories-display {
            background: rgba(255, 255, 255, 0.2);
            padding: 6px 12px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 14px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 50%;
        }

        .sidebar {
            position: fixed;
            top: 0;
            left: -80vw;
            width: 80vw;
            max-width: 250px;
            height: 100vh;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(20px);
            transition: left 0.3s ease;
            z-index: 1001;
            padding-top: 60px;
        }

        .sidebar.open {
            left: 0;
        }

        .sidebar-item {
            padding: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: background 0.3s ease;
            color: white;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .sidebar-item:hover, .sidebar-item.active {
            background: rgba(118, 75, 162, 0.5);
        }

        .main-content {
            margin-top: 70px;
            padding: 10px;
            width: 100%;
            box-sizing: border-box;
        }

        .greeting {
            text-align: center;
            margin-bottom: 20px;
        }

        .greeting h1 {
            font-size: 28px;
            font-style: italic;
            margin-bottom: 8px;
            background: linear-gradient(45deg, #fff, #f0f0f0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .greeting h2 {
            font-size: 16px;
            opacity: 0.8;
            margin-bottom: 15px;
        }

        .quote-section, .current-weight-display, .meal-form, .todays-meals-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .current-weight-display {
            text-align: center;
        }

        .current-weight-display h3 {
            margin-bottom: 6px;
            font-size: 13px;
            opacity: 0.8;
        }

        .current-weight-value {
            font-size: 22px;
            font-weight: bold;
            color: #fff;
        }

        .quote-header {
            font-size: 15px;
            font-weight: bold;
            color: white;
            margin-bottom: 10px;
            text-align: left;
        }

        .quote-text {
            font-style: italic;
            text-align: center;
            color: white;
            font-size: 15px;
            line-height: 1.4;
        }

        .section-header {
            font-size: 15px;
            font-weight: bold;
            color: white;
            margin-bottom: 10px;
        }

        .meals-list {
            color: white;
        }

        .meal-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 3px solid rgba(255, 255, 255, 0.3);
        }

        .meal-details {
            flex: 1;
        }

        .meal-time {
            font-weight: bold;
            font-size: 13px;
            opacity: 0.8;
        }

        .meal-type {
            font-weight: bold;
            margin-bottom: 3px;
        }

        .meal-description {
            font-size: 13px;
            opacity: 0.9;
        }

        .meal-calories {
            background: rgba(102, 126, 234, 0.3);
            padding: 3px 6px;
            border-radius: 15px;
            font-size: 11px;
            font-weight: bold;
            min-width: 50px;
            text-align: center;
        }

        .no-meals {
            text-align: center;
            opacity: 0.7;
            font-style: italic;
            padding: 15px;
        }

        .form-group {
            margin-bottom: 12px;
        }

        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: bold;
            color: white;
        }

        .form-group select, .form-group input[type="text"], .form-group input[type="number"] {
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 14px;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        .form-group select option {
            background: #764ba2;
            color: white;
        }

        .form-group input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.5);
            background: rgba(255, 255, 255, 0.3);
        }

        .emoji-rating {
            display: flex;
            justify-content: space-around;
            margin-top: 8px;
        }

        .emoji-rating span {
            font-size: 24px;
            cursor: pointer;
            opacity: 0.5;
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        .emoji-rating span.selected {
            opacity: 1;
            transform: scale(1.2);
        }

        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: none;
            padding: 12px 25px;
            border-radius: 20px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            font-size: 14px;
            transition: transform 0.3s ease;
            position: relative;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            transform: none;
            cursor: not-allowed;
        }

        .loading {
            display: none;
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }

        .weight-section {
            display: none;
        }

        .weight-section.active {
            display: block;
        }

        .chart-container {
            position: relative;
            width: 100%;
            height: auto;
            min-height: 180px;
            padding: 15px;
            box-sizing: border-box;
        }

        #weightChart {
            width: 100%;
            max-width: 100%;
            height: auto;
        }

        .weight-input-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: none;
            padding: 12px 25px;
            border-radius: 20px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            font-size: 14px;
            margin-bottom: 15px;
        }

        .weight-history {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 15px;
            max-height: 250px;
            overflow-y: auto;
        }

        .weight-entry {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1002;
            left: 0;
            top: 0;
            width: 100vw;
            height: 100vh;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 10% auto;
            padding: 20px;
            border-radius: 12px;
            width: 90%;
            max-width: 350px;
            text-align: center;
            box-sizing: border-box;
        }

        .close {
            color: white;
            float: right;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            margin-top: -15px;
        }

        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }

        .overlay.open {
            display: block;
        }

        .error-message, .success-message {
            background: rgba(255, 0, 0, 0.2);
            border: 1px solid rgba(255, 0, 0, 0.5);
            color: white;
            padding: 8px;
            border-radius: 8px;
            margin: 8px 0;
            display: none;
        }

        .success-message {
            background: rgba(0, 255, 0, 0.2);
            border: 1px solid rgba(0, 255, 0, 0.5);
        }

        @media (max-width: 600px) {
            .main-content {
                padding: 8px;
            }
            .greeting h1 {
                font-size: 24px;
            }
            .greeting h2 {
                font-size: 14px;
            }
            .section-header, .quote-header {
                font-size: 14px;
            }
            .form-group input, .form-group select {
                padding: 8px;
                font-size: 13px;
            }
            .btn-primary, .weight-input-btn {
                padding: 10px 20px;
                font-size: 13px;
            }
            .chart-container {
                min-height: 150px;
            }
        }

        @media (max-width: 360px) {
            .header {
                padding: 8px 10px;
            }
            .calories-display {
                font-size: 12px;
                padding: 5px 10px;
                max-width: 40%;
            }
            .hamburger-menu {
                width: 24px;
                height: 24px;
            }
            .hamburger-line {
                width: 18px;
                height: 2px;
            }
            .modal-content {
                margin: 5% auto;
                padding: 15px;
                width: 95%;
            }
            .greeting h1 {
                font-size: 20px;
            }
            .greeting h2 {
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <button class="hamburger-menu" onclick="toggleSidebar()">
            <div class="hamburger-line"></div>
            <div class="hamburger-line"></div>
            <div class="hamburger-line"></div>
        </button>
        <div class="calories-display">
            Today: <span id="dailyCalories">Loading...</span> cal
        </div>
    </div>

    <div class="overlay" id="overlay" onclick="closeSidebar()"></div>

    <div class="sidebar" id="sidebar">
        <div class="sidebar-item active" onclick="showHome()">üè† Home</div>
        <div class="sidebar-item" onclick="showWeightTracking()">üìä Weight Tracking</div>
    </div>

    <div class="main-content">
        <div id="homeSection">
            <div class="greeting">
                <h1>Hello, Mohammed!</h1>
                <h2>How have you been eating?</h2>
            </div>

            <div class="current-weight-display">
                <h3>Current Weight</h3>
                <div class="current-weight-value" id="currentWeightValue">Loading...</div>
            </div>

            <div class="quote-section">
                <div class="quote-header">Quote of the day</div>
                <div class="quote-text" id="quoteOfTheDay">Loading inspirational quote...</div>
            </div>

            <div class="error-message" id="errorMessage"></div>
            <div class="success-message" id="successMessage"></div>

            <div class="meal-form">
                <h3 style="margin-bottom: 15px; text-align: center; color: white;">Log Your Meal</h3>
                <div class="form-group">
                    <label>Hour of the day:</label>
                    <select id="mealHour">
                        <option value="">Select hour</option>
                        <option value="0">0:00</option>
                        <option value="1">1:00</option>
                        <option value="2">2:00</option>
                        <option value="3">3:00</option>
                        <option value="4">4:00</option>
                        <option value="5">5:00</option>
                        <option value="6">6:00</option>
                        <option value="7">7:00</option>
                        <option value="8">8:00</option>
                        <option value="9">9:00</option>
                        <option value="10">10:00</option>
                        <option value="11">11:00</option>
                        <option value="12">12:00</option>
                        <option value="13">13:00</option>
                        <option value="14">14:00</option>
                        <option value="15">15:00</option>
                        <option value="16">16:00</option>
                        <option value="17">17:00</option>
                        <option value="18">18:00</option>
                        <option value="19">19:00</option>
                        <option value="20">20:00</option>
                        <option value="21">21:00</option>
                        <option value="22">22:00</option>
                        <option value="23">23:00</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Type of meal:</label>
                    <select id="mealType">
                        <option value="">Select meal type</option>
                        <option value="Breakfast">Breakfast</option>
                        <option value="Mid-day snack">Mid-day snack</option>
                        <option value="Lunch">Lunch</option>
                        <option value="Evening snack">Evening snack</option>
                        <option value="Dinner">Dinner</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>What did you eat?</label>
                    <input type="text" id="mealDescription" placeholder="Describe your meal (e.g., 2 chapatis with dal, rice with curry)">
                </div>

                <div class="form-group">
                    <label>Approximate Calories (optional):</label>
                    <input type="number" id="calories" placeholder="Enter calories (optional)" min="0">
                </div>

                <div class="form-group">
                    <label>How did you feel?</label>
                    <div class="emoji-rating" id="feelingRating">
                        <span onclick="selectFeeling(1)">üòû</span>
                        <span onclick="selectFeeling(2)">üòï</span>
                        <span onclick="selectFeeling(3)">üòê</span>
                        <span onclick="selectFeeling(4)">üòä</span>
                        <span onclick="selectFeeling(5)">üòç</span>
                    </div>
                </div>

                <button class="btn-primary" onclick="logMeal()" id="logMealBtn">
                    <span class="btn-text">Log Meal</span>
                    <div class="loading">‚è≥</div>
                </button>
            </div>

            <div class="todays-meals-section">
                <div class="section-header">What I've eaten today</div>
                <div id="todayMealsList" class="meals-list">Loading today's meals...</div>
            </div>
        </div>

        <div id="weightSection" class="weight-section">
            <div style="text-align: center; margin-bottom: 25px;">
                <h1>Weight Tracking</h1>
            </div>

            <div class="chart-container">
                <canvas id="weightChart"></canvas>
            </div>

            <button class="weight-input-btn" onclick="showWeightModal()">Add Today's Weight</button>

            <div class="weight-history">
                <h3 style="margin-bottom: 10px;">Weight History</h3>
                <div id="weightHistoryList">Loading weight history...</div>
            </div>
        </div>
    </div>

    <div id="weightModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeWeightModal()">&times;</span>
            <h2 style="margin-bottom: 15px;">Add Your Weight</h2>
            <div class="error-message" id="weightErrorMessage"></div>
            <div class="form-group">
                <input type="number" id="weightInput" placeholder="Enter weight in KG" step="0.1" min="0">
            </div>
            <button class="btn-primary" onclick="saveWeight()" id="saveWeightBtn">
                <span class="btn-text">Save</span>
                <div class="loading">‚è≥</div>
            </button>
        </div>
    </div>

    <script>
        const CLIENT_ID = '286344757695-g65hshgegne8hp6fgqpbtq9uf05550b2.apps.googleusercontent.com'; // Replace with your OAuth Client ID
        const API_KEY = 'AIzaSyCAcN8DXSRqBv6TDEYikP9O8Eb_C_cFNfw'; // Replace with your API Key
        const SHEET_ID = '10OQj4RyAMYYowEiNXLlN0B6zgUOItZx6RvS9eAC34HY'; // Replace with your Google Sheet ID
        const DISCOVERY_DOC = 'https://sheets.googleapis.com/$discovery/rest?version=v4';
        const SCOPES = 'https://www.googleapis.com/auth/spreadsheets';

        let selectedFeeling = null;
        let weightChart = null;

        const quotes = [
            "The groundwork for all happiness is good health.",
            "Take care of your body. It's the only place you have to live.",
            "Health is not about the weight you lose, but about the life you gain.",
            "Your body can do it. It's your mind you need to convince.",
            "Progress, not perfection.",
            "Small changes lead to big results.",
            "Believe in yourself and all that you are.",
            "Every meal is a fresh start.",
            "You are stronger than your excuses.",
            "Healthy eating is a form of self-respect."
        ];

        async function initGapi() {
            await gapi.load('client:auth2');
            await gapi.client.init({
                apiKey: API_KEY,
                clientId: CLIENT_ID,
                discoveryDocs: [DISCOVERY_DOC],
                scope: SCOPES
            });

            if (!gapi.auth2.getAuthInstance().isSignedIn.get()) {
                try {
                    await gapi.auth2.getAuthInstance().signIn();
                } catch (error) {
                    console.error('Sign-in error:', error);
                    showError('Authentication failed. Please try again.');
                }
            }
            await loadData();
        }

        async function readSheet(range = 'Sheet1!A1:Z1000') {
            try {
                const response = await gapi.client.sheets.spreadsheets.values.get({
                    spreadsheetId: SHEET_ID,
                    range: range
                });
                return response.result.values || [];
            } catch (error) {
                console.error('Read error:', error);
                showError('Failed to load data from sheet.');
                return [];
            }
        }

        async function appendToSheet(values, range = 'Sheet1') {
            try {
                await gapi.client.sheets.spreadsheets.values.append({
                    spreadsheetId: SHEET_ID,
                    range: range,
                    valueInputOption: 'USER_ENTERED',
                    resource: { values: [values] }
                });
            } catch (error) {
                console.error('Write error:', error);
                showError('Failed to save data to sheet.');
            }
        }

        document.addEventListener('DOMContentLoaded', async function() {
            await initGapi();
            await loadQuote();
            await updateCaloriesDisplay();
            await updateCurrentWeight();
            await displayTodaysMeals();
        });

        function selectFeeling(rating) {
            selectedFeeling = rating;
            document.querySelectorAll('#feelingRating span').forEach((span, index) => {
                if (index + 1 === rating) {
                    span.classList.add('selected');
                } else {
                    span.classList.remove('selected');
                }
            });
        }

        async function logMeal() {
            const hour = document.getElementById('mealHour').value;
            const type = document.getElementById('mealType').value;
            const description = document.getElementById('mealDescription').value;
            const calories = document.getElementById('calories').value;

            if (!hour || !type || !description) {
                showError('Please fill in all required fields');
                return;
            }

            if (!selectedFeeling) {
                showError('Please select how you felt');
                return;
            }

            setButtonLoading('logMealBtn', true);

            try {
                const values = [Date.now(), new Date().toDateString(), parseInt(hour), type, description, calories ? parseInt(calories) : '', selectedFeeling, Date.now()];
                await appendToSheet(values, 'Meals!A:H');
                clearMealForm();
                await displayTodaysMeals();
                await updateCaloriesDisplay();
                showSuccess('Meal logged successfully!');
            } catch (error) {
                showError('Failed to log meal.');
            } finally {
                setButtonLoading('logMealBtn', false);
            }
        }

        function clearMealForm() {
            document.getElementById('mealHour').value = '';
            document.getElementById('mealType').value = '';
            document.getElementById('mealDescription').value = '';
            document.getElementById('calories').value = '';
            selectedFeeling = null;
            document.querySelectorAll('#feelingRating span').forEach(span => span.classList.remove('selected'));
        }

        async function displayTodaysMeals() {
            try {
                const data = await readSheet('Meals!A:H');
                const today = new Date().toDateString();
                const mealsList = document.getElementById('todayMealsList');
                const todayMeals = data.filter(row => row[1] === today);

                if (todayMeals.length === 0) {
                    mealsList.innerHTML = '<div class="no-meals">No meals logged today</div>';
                    return;
                }

                let mealsHtml = '';
                todayMeals.forEach(meal => {
                    const feelingEmoji = ['üòû', 'üòï', 'üòê', 'üòä', 'üòç'][meal[6] - 1];
                    mealsHtml += `
                        <div class="meal-item">
                            <div class="meal-details">
                                <div class="meal-time">${meal[2]}:00 ${feelingEmoji}</div>
                                <div class="meal-type">${meal[3]}</div>
                                <div class="meal-description">${meal[4]}</div>
                            </div>
                            <div class="meal-calories">${meal[5] || 'N/A'} cal</div>
                        </div>
                    `;
                });
                mealsList.innerHTML = mealsHtml;
            } catch (error) {
                document.getElementById('todayMealsList').innerHTML = '<div class="no-meals">Error loading meals</div>';
            }
        }

        async function updateCaloriesDisplay() {
            try {
                const data = await readSheet('Meals!A:H');
                const today = new Date().toDateString();
                const total = data
                    .filter(row => row[1] === today && row[5])
                    .reduce((sum, row) => sum + (parseInt(row[5]) || 0), 0);
                document.getElementById('dailyCalories').textContent = total;
            } catch (error) {
                document.getElementById('dailyCalories').textContent = '0';
            }
        }

        function showWeightModal() {
            document.getElementById('weightModal').style.display = 'block';
        }

        function closeWeightModal() {
            document.getElementById('weightModal').style.display = 'none';
            document.getElementById('weightInput').value = '';
            hideError('weightErrorMessage');
        }

        async function saveWeight() {
            const weight = parseFloat(document.getElementById('weightInput').value);
            if (!weight || weight <= 0) {
                showError('Please enter a valid weight', 'weightErrorMessage');
                return;
            }

            setButtonLoading('saveWeightBtn', true);

            try {
                const values = [Date.now(), new Date().toDateString(), weight, Date.now()];
                await appendToSheet(values, 'Weights!A:D');
                await updateCurrentWeight();
                await displayWeightHistory();
                await updateWeightChart();
                showSuccess('Weight saved successfully!');
            } catch (error) {
                showError('Failed to save weight.', 'weightErrorMessage');
            } finally {
                setButtonLoading('saveWeightBtn', false);
                closeWeightModal();
            }
        }

        async function updateCurrentWeight() {
            try {
                const data = await readSheet('Weights!A:D');
                if (data.length > 1) {
                    data.sort((a, b) => b[3] - a[3]); // Sort by timestamp
                    document.getElementById('currentWeightValue').textContent = `${data[1][2]} kg`;
                } else {
                    document.getElementById('currentWeightValue').textContent = 'No data';
                }
            } catch (error) {
                document.getElementById('currentWeightValue').textContent = 'No data';
            }
        }

        async function displayWeightHistory() {
            try {
                const data = await readSheet('Weights!A:D');
                const historyList = document.getElementById('weightHistoryList');
                if (data.length <= 1) {
                    historyList.innerHTML = '<div class="no-meals">No weight data available</div>';
                    return;
                }

                let historyHtml = '';
                data.slice(1).forEach(row => {
                    const date = new Date(parseInt(row[3])).toLocaleDateString();
                    historyHtml += `
                        <div class="weight-entry">
                            <span>${date}</span>
                            <span>${row[2]} kg</span>
                        </div>
                    `;
                });
                historyList.innerHTML = historyHtml;
            } catch (error) {
                historyList.innerHTML = '<div class="no-meals">Error loading weight history</div>';
            }
        }

        function initWeightChart() {
            if (weightChart) {
                updateWeightChart();
                return;
            }

            const ctx = document.getElementById('weightChart').getContext('2d');
            weightChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Weight (kg)',
                        data: [],
                        borderColor: 'rgba(255, 255, 255, 0.8)',
                        backgroundColor: 'rgba(255, 255, 255, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: 'white' }
                        }
                    },
                    scales: {
                        x: {
                            ticks: { color: 'white' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        },
                        y: {
                            ticks: { color: 'white' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        }
                    }
                }
            });
        }

        async function updateWeightChart() {
            if (!weightChart) return;
            try {
                const data = await readSheet('Weights!A:D');
                const sortedData = data.slice(1).map(row => ({
                    date: new Date(parseInt(row[3])).toLocaleDateString(),
                    weight: parseFloat(row[2])
                })).sort((a, b) => new Date(a.date) - new Date(b.date));
                weightChart.data.labels = sortedData.map(row => row.date);
                weightChart.data.datasets[0].data = sortedData.map(row => row.weight);
                weightChart.update();
            } catch (error) {
                console.error('Error updating chart:', error);
            }
        }

        async function loadQuote() {
            try {
                document.getElementById('quoteOfTheDay').textContent = quotes[Math.floor(Math.random() * quotes.length)];
            } catch (error) {
                document.getElementById('quoteOfTheDay').textContent = 'Loading inspirational quote failed.';
            }
        }

        function showHome() {
            document.getElementById('homeSection').style.display = 'block';
            document.getElementById('weightSection').style.display = 'none';
            document.querySelectorAll('.sidebar-item').forEach(item => item.classList.remove('active'));
            document.querySelectorAll('.sidebar-item')[0].classList.add('active');
            closeSidebar();
        }

        function showWeightTracking() {
            document.getElementById('homeSection').style.display = 'none';
            document.getElementById('weightSection').style.display = 'block';
            document.querySelectorAll('.sidebar-item').forEach(item => item.classList.remove('active'));
            document.querySelectorAll('.sidebar-item')[1].classList.add('active');
            initWeightChart();
            displayWeightHistory();
            closeSidebar();
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');
            sidebar.classList.toggle('open');
            overlay.classList.toggle('open');
        }

        function closeSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');
            sidebar.classList.remove('open');
            overlay.classList.remove('open');
        }

        function showError(message, elementId = 'errorMessage') {
            const errorElement = document.getElementById(elementId);
            errorElement.textContent = message;
            errorElement.style.display = 'block';
            setTimeout(() => hideError(elementId), 5000);
        }

        function hideError(elementId = 'errorMessage') {
            const errorElement = document.getElementById(elementId);
            errorElement.style.display = 'none';
        }

        function showSuccess(message, elementId = 'successMessage') {
            const successElement = document.getElementById(elementId);
            successElement.textContent = message;
            successElement.style.display = 'block';
            setTimeout(() => successElement.style.display = 'none', 3000);
        }

        function setButtonLoading(buttonId, isLoading) {
            const button = document.getElementById(buttonId);
            const btnText = button.querySelector('.btn-text');
            const loading = button.querySelector('.loading');
            if (isLoading) {
                button.disabled = true;
                btnText.style.opacity = '0';
                loading.style.display = 'block';
            } else {
                button.disabled = false;
                btnText.style.opacity = '1';
                loading.style.display = 'none';
            }
        }

        window.onclick = function(event) {
            const modal = document.getElementById('weightModal');
            if (event.target === modal) {
                closeWeightModal();
            }
        };

        function setCurrentHour() {
            const now = new Date();
            const currentHour = now.getHours();
            const hourSelect = document.getElementById('mealHour');
            if (!hourSelect.value) {
                hourSelect.value = currentHour.toString();
            }
        }

        document.getElementById('mealHour').addEventListener('focus', setCurrentHour);
    </script>
</body>
</html>
